<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Trading Bot v7.0 - Ger√ßek Multi-Exchange Veri</title>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- TradingView Widget -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <style>
        /* AYNI CSS KODLARI - DEƒûƒ∞≈ûMEDƒ∞ */
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #141a27;
            --bg-card: #1a2133;
            --accent-blue: #3b82f6;
            --accent-blue-light: #60a5fa;
            --accent-green: #10b981;
            --accent-green-light: #34d399;
            --accent-red: #ef4444;
            --accent-red-light: #f87171;
            --accent-purple: #8b5cf6;
            --accent-purple-light: #a78bfa;
            --accent-yellow: #f59e0b;
            --accent-orange: #f97316;
            --accent-cyan: #06b6d4;
            --accent-pink: #ec4899;
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;
            --border-color: rgba(255, 255, 255, 0.1);
            --border-radius: 16px;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.2);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.4);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --neon-blue: 0 0 20px rgba(59, 130, 246, 0.5);
            --neon-green: 0 0 20px rgba(16, 185, 129, 0.5);
            --neon-red: 0 0 20px rgba(239, 68, 68, 0.5);
            --neon-purple: 0 0 20px rgba(139, 92, 246, 0.5);
            --neon-cyan: 0 0 20px rgba(6, 182, 212, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0a0f1a 0%, #0f1423 50%, #141a27 100%);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(16, 185, 129, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
            animation: bgPulse 8s ease-in-out infinite;
        }

        @keyframes bgPulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        .container-fluid {
            position: relative;
            z-index: 1;
            max-width: 1800px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        .navbar {
            background: rgba(26, 33, 51, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 2px solid var(--accent-blue);
            padding: 1rem 0;
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar-brand {
            font-weight: 800;
            font-size: 1.5rem;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, #ffffff, var(--accent-blue-light), var(--accent-purple-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }

        .navbar-brand i {
            color: var(--accent-blue);
            margin-right: 8px;
            text-shadow: 0 0 15px var(--accent-blue);
        }

        .status-badge {
            background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan));
            padding: 8px 24px;
            border-radius: 30px;
            font-size: 0.9rem;
            font-weight: 700;
            box-shadow: var(--neon-green);
            animation: pulse 2s ease-in-out infinite;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 25px rgba(16, 185, 129, 0.5); }
            50% { box-shadow: 0 0 40px rgba(16, 185, 129, 0.8); }
        }

        .card {
            background: rgba(26, 33, 51, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            overflow: hidden;
            position: relative;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent-blue), var(--accent-purple), var(--accent-cyan), transparent);
            animation: borderFlow 4s linear infinite;
        }

        @keyframes borderFlow {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .card:hover {
            transform: translateY(-6px);
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.3);
            border-color: rgba(59, 130, 246, 0.4);
        }

        .card-header {
            background: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid rgba(59, 130, 246, 0.3);
            padding: 1rem 1.5rem;
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--accent-blue-light);
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.2);
        }

        .card-body {
            padding: 1.5rem;
        }

        .current-price {
            font-size: 3.8rem;
            font-weight: 900;
            letter-spacing: -2px;
            background: linear-gradient(135deg, #ffffff, var(--accent-blue-light), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.1;
            margin: 1rem 0;
            text-shadow: 0 0 30px rgba(59, 130, 246, 0.4);
            animation: priceGlow 2s ease-in-out infinite;
        }

        @keyframes priceGlow {
            0%, 100% { text-shadow: 0 0 30px rgba(59, 130, 246, 0.4); }
            50% { text-shadow: 0 0 50px rgba(59, 130, 246, 0.7); }
        }

        .price-change {
            font-size: 1.3rem;
            font-weight: 700;
            margin-top: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .price-up {
            color: var(--accent-green);
            background: rgba(16, 185, 129, 0.15);
            padding: 8px 20px;
            border-radius: 20px;
            box-shadow: var(--neon-green);
            border: 1px solid rgba(16, 185, 129, 0.5);
        }

        .price-down {
            color: var(--accent-red);
            background: rgba(239, 68, 68, 0.15);
            padding: 8px 20px;
            border-radius: 20px;
            box-shadow: var(--neon-red);
            border: 1px solid rgba(239, 68, 68, 0.5);
        }

        .signal-badge {
            padding: 2.5rem 2rem;
            border-radius: var(--border-radius);
            font-size: 2.2rem;
            font-weight: 900;
            letter-spacing: -0.5px;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.2);
            background-clip: padding-box;
        }

        .signal-text {
            position: relative;
            z-index: 2;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .signal-buy {
            background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan));
            color: white;
            box-shadow: 0 0 30px rgba(16, 185, 129, 0.6);
        }

        .signal-sell {
            background: linear-gradient(135deg, var(--accent-red), var(--accent-orange));
            color: white;
            box-shadow: 0 0 30px rgba(239, 68, 68, 0.6);
        }

        .signal-neutral {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
            color: white;
            box-shadow: 0 0 30px rgba(139, 92, 246, 0.6);
        }

        .chart-container {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 1.5rem;
            height: 800px !important;
            min-height: 800px !important;
            max-height: 800px !important;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
        }

        #tradingview-widget {
            width: 100%;
            height: 100% !important;
            min-height: 750px;
            flex: 1;
        }

        .chat-container {
            height: 400px;
            overflow-y: auto;
            background: rgba(20, 26, 39, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            position: relative;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .chat-message {
            margin-bottom: 1.2rem;
            padding: 1.2rem;
            border-radius: 16px;
            animation: slideIn 0.4s ease;
            position: relative;
            max-width: 90%;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chat-bot {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2));
            border-left: 4px solid var(--accent-blue);
            box-shadow: 0 0 25px rgba(59, 130, 246, 0.1);
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .btn-evaluate {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink), var(--accent-cyan));
            background-size: 200% 200%;
            color: white;
            font-weight: 800;
            padding: 1rem 2rem;
            border-radius: 40px;
            box-shadow: 0 0 35px rgba(139, 92, 246, 0.5);
            animation: gradientShift 3s ease infinite;
            border: 1px solid rgba(255, 255, 255, 0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .btn-evaluate:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 50px rgba(139, 92, 246, 0.8);
        }

        .form-select {
            background: rgba(26, 33, 51, 0.9);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 30px;
            font-weight: 600;
            padding: 0.75rem 1.25rem;
            transition: var(--transition);
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            backdrop-filter: blur(5px);
        }

        .form-select:focus {
            background: rgba(26, 33, 51, 0.95);
            border-color: var(--accent-blue);
            box-shadow: 0 0 25px rgba(59, 130, 246, 0.3);
            color: var(--text-primary);
        }

        .indicator-detail-card {
            background: rgba(20, 26, 39, 0.9);
            backdrop-filter: blur(5px);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--accent-blue);
            transition: var(--transition);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .indicator-detail-card.buy {
            border-left-color: var(--accent-green);
        }

        .indicator-detail-card.sell {
            border-left-color: var(--accent-red);
        }

        .indicator-signal-buy {
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-green-light);
            border: 1px solid var(--accent-green);
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.2);
        }

        .indicator-signal-sell {
            background: rgba(239, 68, 68, 0.2);
            color: var(--accent-red-light);
            border: 1px solid var(--accent-red);
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.2);
        }

        .indicator-signal-neutral {
            background: rgba(139, 92, 246, 0.2);
            color: var(--accent-purple-light);
            border: 1px solid var(--accent-purple);
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.2);
        }

        .pattern-tag {
            display: inline-block;
            padding: 10px 18px;
            margin: 6px 4px;
            border-radius: 24px;
            font-size: 0.9rem;
            font-weight: 700;
            transition: var(--transition);
            border: 1px solid transparent;
        }

        .pattern-bullish {
            background: rgba(16, 185, 129, 0.15);
            color: var(--accent-green-light);
            border-color: var(--accent-green);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
        }

        .pattern-bearish {
            background: rgba(239, 68, 68, 0.15);
            color: var(--accent-red-light);
            border-color: var(--accent-red);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.2);
        }

        .pattern-neutral {
            background: rgba(139, 92, 246, 0.15);
            color: var(--accent-purple-light);
            border-color: var(--accent-purple);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.2);
        }

        .exchange-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
        }

        .exchange-card {
            background: rgba(20, 26, 39, 0.8);
            backdrop-filter: blur(5px);
            border-radius: 16px;
            padding: 1rem;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .exchange-card:hover {
            transform: translateY(-3px);
            border-color: var(--accent-blue);
            box-shadow: 0 0 25px rgba(59, 130, 246, 0.2);
            background: rgba(59, 130, 246, 0.1);
        }

        .status-active {
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-green);
            border: 1px solid var(--accent-green);
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.2);
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid var(--accent-blue);
            border-right: 4px solid var(--accent-purple);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            box-shadow: 0 0 25px rgba(59, 130, 246, 0.3);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(26, 33, 51, 0.95);
            backdrop-filter: blur(10px);
            color: white;
            padding: 1.2rem 2rem;
            border-radius: 16px;
            border-left: 4px solid;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            z-index: 9999;
            animation: slideInRight 0.3s ease, fadeOut 0.5s 2.5s ease;
            min-width: 300px;
            font-weight: 600;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .notification.success { border-left-color: var(--accent-green); box-shadow: 0 0 20px rgba(16, 185, 129, 0.3); }
        .notification.error { border-left-color: var(--accent-red); box-shadow: 0 0 20px rgba(239, 68, 68, 0.3); }
        .notification.info { border-left-color: var(--accent-blue); box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }

        @keyframes slideInRight {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        .model-bar {
            height: 14px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            overflow: hidden;
            margin: 0.8rem 0;
            border: 1px solid var(--border-color);
        }

        .model-fill {
            height: 100%;
            border-radius: 12px;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .model-lgbm {
            background: linear-gradient(90deg, var(--accent-green), var(--accent-cyan));
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.4);
        }

        .model-lstm {
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-cyan));
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.4);
        }

        .model-transformer {
            background: linear-gradient(90deg, var(--accent-purple), var(--accent-pink));
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.4);
        }
    </style>
</head>
<body>

<nav class="navbar">
    <div class="container-fluid">
        <a class="navbar-brand">
            <i class="fas fa-robot"></i>
            Trading Bot v7.0 - GER√áEK MULTI-EXCHANGE
            <span class="connection-status status-connected ms-3" id="connectionStatus">
                <i class="fas fa-plug"></i>
                <span id="activeExchanges">0</span>/12 Exchange Baƒülƒ±
            </span>
        </a>
        <div class="d-flex align-items-center gap-3">
            <span class="status-badge">
                <i class="fas fa-circle"></i>
                BACKEND BAƒûLI
            </span>
            <button class="btn btn-primary btn-sm" onclick="forceRefresh()">
                <i class="fas fa-sync-alt"></i>
                Yenile
            </button>
        </div>
    </div>
</nav>

<div class="container-fluid mt-4 px-3">
    <div class="row g-4">
        <!-- SOL ANA KOLON -->
        <div class="col-lg-8">
            <!-- Kontrol Paneli -->
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-sliders-h"></i>
                    Analiz Kontrolleri
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-chart-line"></i>
                            Ger√ßek Zamanlƒ± Multi-Exchange Veri
                            <span class="badge bg-primary ms-2" id="dataSourceBadge">
                                
                            </span>
                        </h5>
                        <div class="d-flex gap-3 flex-wrap">
                            <select id="symbolSelect" class="form-select form-select-sm" style="width: 160px;">
                                <option value="BTC">BTC/USDT</option>
                                <option value="ETH">ETH/USDT</option>
                                <option value="XRP" selected>XRP/USDT</option>
                                <option value="SOL">SOL/USDT</option>
                                <option value="BNB">BNB/USDT</option>
                                <option value="ADA">ADA/USDT</option>
                                <option value="DOGE">DOGE/USDT</option>
                                <option value="MATIC">MATIC/USDT</option>
                                <option value="LINK">LINK/USDT</option>
                                <option value="AVAX">AVAX/USDT</option>
                            </select>
                            <select id="intervalSelect" class="form-select form-select-sm" style="width: 130px;">
                                <option value="1m">1 Dakika</option>
                                <option value="5m">5 Dakika</option>
                                <option value="15m">15 Dakika</option>
                                <option value="30m">30 Dakika</option>
                                <option value="1h" selected>1 Saat</option>
                                <option value="4h">4 Saat</option>
                                <option value="1d">1 G√ºn</option>
                                <option value="1w">1 Hafta</option>
                            </select>
                            <button class="btn btn-primary" onclick="analyze()">
                                <i class="fas fa-search"></i>
                                Analiz Et
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Fiyat ve Sinyal -->
            <div class="row g-4 mb-4">
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-header">
                            <i class="fas fa-dollar-sign"></i>
                            G√ºncel Fiyat
                            <span class="badge bg-info ms-2" id="priceSources">-</span>
                        </div>
                        <div class="card-body text-center">
                            <div class="symbol-name fs-4" id="currentSymbol">XRP/USDT</div>
                            <div class="current-price" id="currentPrice">
                                <span class="spinner"></span>
                            </div>
                            <div class="price-change" id="priceChange"></div>
                            <div class="row mt-4">
                                <div class="col-6">
                                    <div class="text-muted small">24s Hacim</div>
                                    <div class="fs-4 text-cyan" id="volume24h">-</div>
                                </div>
                                <div class="col-6">
                                    <div class="text-muted small">Kaynak Sayƒ±sƒ±</div>
                                    <div class="fs-4 text-purple" id="sourceCount">-</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-header">
                            <i class="fas fa-brain"></i>
                            AI Sinyali
                        </div>
                        <div class="card-body text-center">
                            <div class="signal-badge signal-neutral" id="signalBadge">
                                <span class="signal-text" id="signalText">BEKLENƒ∞YOR</span>
                            </div>
                            <div class="progress mb-3" style="height: 10px;">
                                <div class="progress-bar" id="confidenceFill" role="progressbar" style="width: 0%; background: linear-gradient(90deg, var(--accent-blue), var(--accent-cyan));"></div>
                            </div>
                            <div class="fw-bold" id="confidenceText">G√ºven: 0%</div>
                            <p class="text-muted small mt-3 mb-0" id="signalRecommendation">
                                Backend baƒülantƒ±sƒ± bekleniyor...
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sinyal Daƒüƒ±lƒ±mƒ± -->
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-chart-bar"></i>
                    Sinyal Daƒüƒ±lƒ±mƒ± - 11+ Exchange Konsens√ºs
                </div>
                <div class="card-body">
                    <div class="mb-4">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-success">AL</span>
                            <span class="text-success" id="buySignalValue">0%</span>
                        </div>
                        <div class="progress" style="height: 20px;">
                            <div class="progress-bar bg-success" id="buySignalBar" role="progressbar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-danger">SAT</span>
                            <span class="text-danger" id="sellSignalValue">0%</span>
                        </div>
                        <div class="progress" style="height: 20px;">
                            <div class="progress-bar bg-danger" id="sellSignalBar" role="progressbar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-secondary">N√ñTR</span>
                            <span class="text-secondary" id="neutralSignalValue">0%</span>
                        </div>
                        <div class="progress" style="height: 20px;">
                            <div class="progress-bar bg-secondary" id="neutralSignalBar" role="progressbar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TradingView Chart -->
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-chart-candlestick"></i>
                    Canlƒ± Fiyat Grafiƒüi - TradingView
                    <span class="badge bg-dark ms-2">Binance</span>
                </div>
                <div class="card-body p-0">
                    <div class="chart-container" style="border-radius: 0 0 16px 16px;">
                        <div id="tradingview-widget"></div>
                    </div>
                </div>
            </div>

            <!-- Teknik G√∂stergeler -->
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-layer-group"></i>
                    Detaylƒ± Teknik Analiz
                </div>
                <div class="card-body">
                    <div id="detailedIndicators">
                        <div class="text-center py-5">
                            <div class="spinner mb-3"></div>
                            <p class="text-muted">Backend'den teknik g√∂stergeler bekleniyor...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pattern ve Market Structure -->
            <div class="row g-4">
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-header">
                            <i class="fas fa-shapes"></i>
                            Mum Patternleri
                        </div>
                        <div class="card-body">
                            <div id="patternsContainer" class="mt-2">
                                <span class="text-muted">Pattern verisi bekleniyor...</span>
                            </div>
                            <p class="mt-4 mb-0 text-muted small" id="patternCount">-</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-header">
                            <i class="fas fa-exchange-alt"></i>
                            Market Yapƒ±sƒ±
                        </div>
                        <div class="card-body">
                            <div id="marketStructureContainer">
                                <div class="indicator-detail-card neutral mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span><i class="fas fa-project-diagram"></i> Yapƒ±</span>
                                        <span class="badge bg-secondary" id="structureSignal">-</span>
                                    </div>
                                    <div class="fs-5 mt-2" id="structureValue">-</div>
                                    <small class="text-muted" id="structureDesc">-</small>
                                </div>
                                <div class="indicator-detail-card neutral mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span><i class="fas fa-trend-up"></i> Trend</span>
                                        <span class="badge bg-secondary" id="trendSignal">-</span>
                                    </div>
                                    <div class="fs-5 mt-2" id="trendValue">-</div>
                                    <small class="text-muted" id="trendDesc">-</small>
                                </div>
                                <div class="indicator-detail-card neutral">
                                    <div class="d-flex justify-content-between">
                                        <span><i class="fas fa-bolt"></i> Volatilite</span>
                                        <span class="badge bg-secondary" id="volatilitySignal">-</span>
                                    </div>
                                    <div class="fs-5 mt-2" id="volatilityValue">-</div>
                                    <small class="text-muted" id="volatilityDesc">-</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SAƒû KOLON -->
        <div class="col-lg-4">
            <!-- AI Asistan -->
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-comments"></i>
                    AI Trading Asistanƒ±
                    <span class="badge bg-purple ms-2">Ger√ßek Veri</span>
                </div>
                <div class="card-body">
                    <div class="chat-container" id="chatMessages">
                        <div class="chat-message chat-bot">
                            <strong>ü§ñ AI Asistan:</strong><br>
                            ‚ö° Backend baƒülantƒ±sƒ± kuruluyor...<br>
                            üìä 11+ exchange ve CoinGecko verileri bekleniyor.
                        </div>
                    </div>
                    <div class="mt-3">
                        <button class="btn btn-evaluate w-100" onclick="evaluateAI()">
                            <i class="fas fa-brain"></i>
                            Fƒ∞YATI AI ƒ∞LE DEƒûERLENDƒ∞R
                        </button>
                    </div>
                </div>
            </div>

            <!-- ML Modelleri -->
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-brain"></i>
                    Makine √ñƒürenmesi Modelleri
                    <span class="badge bg-info ms-2">LightGBM/LSTM/Transformer</span>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <span><i class="fas fa-tree"></i> LightGBM</span>
                            <span class="text-success" id="lgbmAccuracy">-%</span>
                        </div>
                        <div class="model-bar">
                            <div class="model-fill model-lgbm" id="lgbmBar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <span><i class="fas fa-brain"></i> LSTM</span>
                            <span style="color: var(--accent-blue);" id="lstmAccuracy">-%</span>
                        </div>
                        <div class="model-bar">
                            <div class="model-fill model-lstm" id="lstmBar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <span><i class="fas fa-infinity"></i> Transformer</span>
                            <span style="color: var(--accent-purple);" id="transformerAccuracy">-%</span>
                        </div>
                        <div class="model-bar">
                            <div class="model-fill model-transformer" id="transformerBar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="mt-4 pt-3 border-top">
                        <p class="mb-2" id="mlPrediction">
                            <strong>Ensemble Tahmin:</strong>
                            <span class="ms-2" id="ensemblePrediction">-</span>
                        </p>
                        <button class="btn btn-outline-success w-100 mt-3" onclick="trainML()">
                            <i class="fas fa-sync-alt"></i>
                            Modelleri Eƒüit
                        </button>
                    </div>
                </div>
            </div>

            <!-- Exchange Durumlarƒ± -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-cloud"></i>
                    Canlƒ± Veri Kaynaklarƒ±
                    <span class="connection-status status-connected ms-2" id="exchangeStatusBadge">
                        <i class="fas fa-check-circle"></i>
                        <span id="activeExchangeCount">0</span>/12 Aktif
                    </span>
                </div>
                <div class="card-body">
                    <div class="exchange-grid" id="exchangeGrid">
                        <!-- JS ile doldurulacak -->
                    </div>
                    <div class="mt-4 pt-3 border-top">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">
                                <i class="fas fa-sync"></i> Son G√ºncelleme:
                            </span>
                            <span id="lastUpdate" class="fw-bold text-cyan">-</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span class="text-muted">
                                <i class="fas fa-database"></i> Veri Durumu:
                            </span>
                            <span id="dataIntegrity" class="fw-bold text-success">GER√áEK ZAMANLI</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// ============================================
// GER√áEK VERƒ∞ - BACKEND BAƒûLANTILI
// SENTETƒ∞K VERƒ∞ KESƒ∞NLƒ∞KLE YASAK!
// SADECE main.py'den GELEN GER√áEK VERƒ∞LER
// ============================================

// ========== GLOBAL DEƒûƒ∞≈ûKENLER ==========
let backendUrl = '';
let wsConnection = null;
let refreshInterval = null;
let currentAnalysisData = null;

// Exchange listesi (g√∂rsel i√ßin)
const exchangeList = [
    { name: 'Binance', icon: 'fa-bitcoin', color: 'text-primary' },
    { name: 'Bybit', icon: 'fa-coins', color: 'text-warning' },
    { name: 'OKX', icon: 'fa-chart-bar', color: 'text-info' },
    { name: 'KuCoin', icon: 'fa-database', color: 'text-success' },
    { name: 'Gate.io', icon: 'fa-gem', color: 'text-danger' },
    { name: 'MEXC', icon: 'fa-rocket', color: 'text-purple' },
    { name: 'Kraken', icon: 'fa-exchange-alt', color: 'text-secondary' },
    { name: 'Bitfinex', icon: 'fa-fire', color: 'text-orange' },
    { name: 'Huobi', icon: 'fa-burn', color: 'text-cyan' },
    { name: 'Coinbase', icon: 'fa-shopping-cart', color: 'text-blue' },
    { name: 'Bitget', icon: 'fa-bolt', color: 'text-teal' },
    { name: 'CoinGecko', icon: 'fa-dragon', color: 'text-success' }
];

// Interval d√∂n√º≈ü√ºm (TradingView i√ßin)
const intervalMap = {
    '1m': '1', '5m': '5', '15m': '15', '30m': '30',
    '1h': '60', '4h': '240', '1d': 'D', '1w': 'W'
};

// ========== BA≈ûLANGI√á ==========
document.addEventListener('DOMContentLoaded', async function() {
    console.log('üöÄ Frontend ba≈ülatƒ±lƒ±yor - SENTETƒ∞K VERƒ∞ YASAK');
    
    // Exchange grid'i olu≈ütur
    renderExchangeGrid();
    
    // Backend baƒülantƒ±sƒ±nƒ± dene
    await checkBackendConnection();
    
    // TradingView widget'ƒ± y√ºkle
    loadTradingView();
    
    // ƒ∞lk analizi yap
    analyze();
    
    // 30 saniyede bir otomatik yenile
    refreshInterval = setInterval(() => {
        if (document.visibilityState === 'visible') {
            analyze(false); // Bildirim g√∂sterme
        }
    }, 30000);
});

// ========== BACKEND BAƒûLANTI KONTROL√ú ==========
async function checkBackendConnection() {
    try {
        // Backend URL'ini bul (g√∂receli veya localhost)
        const baseUrl = window.location.origin;
        
        const response = await fetch(`${baseUrl}/health`, {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' },
            timeout: 5000
        });
        
        if (response.ok) {
            const data = await response.json();
            backendUrl = baseUrl;
            console.log('‚úÖ Backend baƒülantƒ±sƒ± ba≈üarƒ±lƒ±:', data);
            
            document.getElementById('connectionStatus').innerHTML = `
                <i class="fas fa-plug"></i>
                <span id="activeExchanges">${data.exchanges?.active || 11}+</span>/12 Exchange Baƒülƒ±
            `;
            
            showNotification('‚úÖ Backend baƒülantƒ±sƒ± kuruldu', 'success');
            return true;
        }
    } catch (error) {
        console.error('‚ùå Backend baƒülantƒ±sƒ± ba≈üarƒ±sƒ±z:', error);
        
        // Backend baƒülantƒ±sƒ± yok - HATA MESAJI G√ñSTER, SENTETƒ∞K VERƒ∞ YOK!
        document.getElementById('connectionStatus').innerHTML = `
            <i class="fas fa-plug text-danger"></i>
            <span class="text-danger">Backend Baƒülƒ± Deƒüil</span>
        `;
        
        showNoDataMessage('Backend sunucusuna baƒülanƒ±lamƒ±yor. L√ºtfen main.py\'yi ba≈ülatƒ±n.');
        return false;
    }
}

// ========== ANA ANALƒ∞Z FONKSƒ∞YONU - SADECE BACKEND'DEN VERƒ∞ ==========
async function analyze(showNotif = true) {
    const symbol = document.getElementById('symbolSelect').value;
    const interval = document.getElementById('intervalSelect').value;
    
    // Backend URL kontrol√º
    if (!backendUrl) {
        const connected = await checkBackendConnection();
        if (!connected) return;
    }
    
    if (showNotif) {
        showNotification(`üìä ${symbol}/USDT analiz ediliyor...`, 'info');
    }
    
    try {
        // SADECE GER√áEK BACKEND API
        const response = await fetch(
            `${backendUrl}/api/analyze/${symbol}USDT?interval=${interval}&limit=100`,
            {
                method: 'GET',
                headers: { 'Content-Type': 'application/json' },
                timeout: 15000
            }
        );
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.success) {
            // T√úM VERƒ∞LER BACKEND'DEN - SENTETƒ∞K YOK!
            currentAnalysisData = data;
            updateDashboardWithRealData(data);
            
            if (showNotif) {
                showNotification(`‚úÖ ${symbol}/USDT analiz tamamlandƒ±`, 'success');
            }
        } else {
            throw new Error(data.message || 'Bilinmeyen hata');
        }
        
    } catch (error) {
        console.error('‚ùå Analiz hatasƒ±:', error);
        
        // HATA DURUMUNDA Bƒ∞LE SENTETƒ∞K VERƒ∞ YOK!
        // SADECE hata mesajƒ± g√∂ster
        showNoDataMessage(`Backend hatasƒ±: ${error.message}. L√ºtfen main.py'yi kontrol edin.`);
    }
}
//=========================================GOSTERRGE GAUGE=======================
    // Gauge'ƒ± g√ºncelleyen fonksiyon
function updateGaugeWidget() {
    const symbol = document.getElementById('symbolSelect').value + 'USDT';
    const interval = document.getElementById('intervalSelect').value;

    // Widget konteynerini temizle
    const container = document.getElementById('technical-gauge-widget');
    if (!container) return;
    container.innerHTML = '';

    // TradingView Technical Analysis Widget
    new TradingView.widget({
        "container_id": "technical-gauge-widget",
        "width": "100%",
        "height": 420,
        "symbol": `BINANCE:${symbol}`,
        "interval": intervalMap[interval] || "60", // Mevcut intervalMap'ini kullan
        "locale": "tr",
        "colorTheme": "dark",
        "isTransparent": false,
        "show_interval_tabs": true,
        "backgroundColor": "rgba(26, 33, 51, 1)",
        "gridLineColor": "rgba(59, 130, 246, 0.1)",
        "trendLineColor": "rgba(59, 130, 246, 1)",
        "underLineColor": "rgba(16, 185, 129, 0.3)",
        "underLineBottomColor": "rgba(16, 185, 129, 0.1)"
    });
}

// updateDashboardWithRealData fonksiyonunun sonuna ekle:
updateGaugeWidget();  // Veri geldiƒüinde gauge'ƒ± da g√ºncelle
// ========== BACKEND'DEN GELEN GER√áEK VERƒ∞ ƒ∞LE DASHBOARD G√úNCELLEME ==========
function updateDashboardWithRealData(data) {
    if (!data) return;
    
    // ===== 1. Fƒ∞YAT VERƒ∞LERƒ∞ =====
    if (data.price_data) {
        const price = data.price_data.current;
        const change = data.price_data.change_percent;
        const volume = data.price_data.volume_24h;
        
        // Fiyat
        document.getElementById('currentPrice').innerHTML = price > 0 
            ? `$${price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`
            : '‚Äî';
        
        // 24s Deƒüi≈üim
        const changeEl = document.getElementById('priceChange');
        if (change !== 0) {
            changeEl.className = change >= 0 ? 'price-change price-up' : 'price-change price-down';
            changeEl.innerHTML = change >= 0 
                ? `<i class="fas fa-arrow-up"></i> ${change.toFixed(2)}% (24s)`
                : `<i class="fas fa-arrow-down"></i> ${Math.abs(change).toFixed(2)}% (24s)`;
        } else {
            changeEl.innerHTML = 'Deƒüi≈üim verisi yok';
        }
        
        // Hacim
        document.getElementById('volume24h').innerHTML = volume > 0 
            ? (volume > 1e9 ? `$${(volume/1e9).toFixed(2)}B` : `$${(volume/1e6).toFixed(2)}M`)
            : '‚Äî';
    }
    
    // ===== 2. Sƒ∞NYAL =====
    if (data.signal) {
        const signal = data.signal.signal || 'NEUTRAL';
        const confidence = data.signal.confidence || 0;
        const recommendation = data.signal.recommendation || 'Veri bekleniyor';
        
        document.getElementById('signalText').innerHTML = signal.replace(/_/g, ' ');
        document.getElementById('signalBadge').className = 'signal-badge ' + 
            (signal.includes('BUY') ? 'signal-buy' : 
             signal.includes('SELL') ? 'signal-sell' : 'signal-neutral');
        
        document.getElementById('confidenceFill').style.width = confidence + '%';
        document.getElementById('confidenceText').innerHTML = `G√ºven: ${confidence.toFixed(1)}%`;
        document.getElementById('signalRecommendation').innerHTML = recommendation;
    }
    
    // ===== 3. Sƒ∞NYAL DAƒûILIMI =====
    if (data.signal_distribution) {
        const buy = data.signal_distribution.buy || 33;
        const sell = data.signal_distribution.sell || 33;
        const neutral = data.signal_distribution.neutral || 34;
        
        document.getElementById('buySignalBar').style.width = buy + '%';
        document.getElementById('buySignalValue').innerHTML = buy + '%';
        document.getElementById('sellSignalBar').style.width = sell + '%';
        document.getElementById('sellSignalValue').innerHTML = sell + '%';
        document.getElementById('neutralSignalBar').style.width = neutral + '%';
        document.getElementById('neutralSignalValue').innerHTML = neutral + '%';
    }
    
    // ===== 4. TEKNƒ∞K G√ñSTERGELER =====
    if (data.technical_indicators) {
        updateTechnicalIndicators(data.technical_indicators);
    }
    
    // ===== 5. PATTERNS =====
    if (data.patterns && Array.isArray(data.patterns)) {
        updatePatterns(data.patterns);
    }
    
    // ===== 6. MARKET STRUCTURE =====
    if (data.market_structure) {
        updateMarketStructure(data.market_structure);
    }
    
    // ===== 7. ML STATS =====
    if (data.ml_stats) {
        updateMLStats(data.ml_stats);
    }
    
    // ===== 8. KAYNAK SAYISI =====
    if (data.price_data?.source_count) {
        document.getElementById('sourceCount').innerHTML = data.price_data.source_count + ' borsa';
        document.getElementById('priceSources').innerHTML = 
            `${data.price_data.source_count || 0} kaynak`;
    }
    
    // Son g√ºncelleme zamanƒ±
    document.getElementById('lastUpdate').innerHTML = 
        new Date().toLocaleTimeString('tr-TR');
}

// ========== TEKNƒ∞K G√ñSTERGELERƒ∞ G√úNCELLE ==========
function updateTechnicalIndicators(indicators) {
    const container = document.getElementById('detailedIndicators');
    
    if (!indicators || Object.keys(indicators).length === 0) {
        container.innerHTML = '<div class="text-center py-4"><p class="text-muted">Teknik g√∂sterge verisi yok</p></div>';
        return;
    }
    
    container.innerHTML = `
        <div class="row g-3">
            <div class="col-md-6">
                <div class="indicator-detail-card ${indicators.rsi_value >= 70 ? 'sell' : indicators.rsi_value <= 30 ? 'buy' : 'neutral'}">
                    <div class="d-flex justify-content-between">
                        <span><i class="fas fa-chart-line"></i> RSI (14)</span>
                        <span class="badge ${indicators.rsi_value >= 70 ? 'bg-danger' : indicators.rsi_value <= 30 ? 'bg-success' : 'bg-secondary'}">
                            ${indicators.rsi_value >= 70 ? 'A≈ûIRI ALIM' : indicators.rsi_value <= 30 ? 'A≈ûIRI SATIM' : 'N√ñTR'}
                        </span>
                    </div>
                    <div class="fs-4 mt-2 ${indicators.rsi_value >= 70 ? 'text-danger' : indicators.rsi_value <= 30 ? 'text-success' : ''}">
                        ${indicators.rsi_value?.toFixed(2) || '50.00'}
                    </div>
                    <small class="text-muted">
                        ${indicators.rsi_value >= 70 ? 'A≈üƒ±rƒ± alƒ±m b√∂lgesi' : 
                          indicators.rsi_value <= 30 ? 'A≈üƒ±rƒ± satƒ±m b√∂lgesi' : 
                          'Normal b√∂lge'}
                    </small>
                </div>
            </div>
            <div class="col-md-6">
                <div class="indicator-detail-card ${indicators.macd_histogram > 0 ? 'buy' : 'sell'}">
                    <div class="d-flex justify-content-between">
                        <span><i class="fas fa-exchange-alt"></i> MACD</span>
                        <span class="badge ${indicators.macd_histogram > 0 ? 'bg-success' : 'bg-danger'}">
                            ${indicators.macd_histogram > 0 ? 'AL' : 'SAT'}
                        </span>
                    </div>
                    <div class="fs-5 mt-2">
                        ${indicators.macd_histogram?.toFixed(4) || '0.0000'}
                    </div>
                    <small class="text-muted">
                        ${indicators.macd_histogram > 0 ? 'Momentum yukarƒ±' : 'Momentum a≈üaƒüƒ±'}
                    </small>
                </div>
            </div>
            <div class="col-md-6">
                <div class="indicator-detail-card ${indicators.bb_position >= 80 ? 'sell' : indicators.bb_position <= 20 ? 'buy' : 'neutral'}">
                    <div class="d-flex justify-content-between">
                        <span><i class="fas fa-chart-bar"></i> Bollinger</span>
                        <span class="badge ${indicators.bb_position >= 80 ? 'bg-danger' : indicators.bb_position <= 20 ? 'bg-success' : 'bg-secondary'}">
                            ${indicators.bb_position >= 80 ? '√úST BANT' : indicators.bb_position <= 20 ? 'ALT BANT' : 'ORTA'}
                        </span>
                    </div>
                    <div class="fs-5 mt-2">
                        ${indicators.bb_position?.toFixed(1) || '50'}%
                    </div>
                    <small class="text-muted">
                        ${indicators.bb_position >= 80 ? 'Diren√ß b√∂lgesi' : 
                          indicators.bb_position <= 20 ? 'Destek b√∂lgesi' : 
                          'N√∂tr b√∂lge'}
                    </small>
                </div>
            </div>
            <div class="col-md-6">
                <div class="indicator-detail-card neutral">
                    <div class="d-flex justify-content-between">
                        <span><i class="fas fa-chart-area"></i> Hacim</span>
                        <span class="badge ${indicators.volume_ratio > 1.5 ? 'bg-warning' : 'bg-secondary'}">
                            ${indicators.volume_ratio > 1.5 ? 'Y√úKSEK' : 'NORMAL'}
                        </span>
                    </div>
                    <div class="fs-5 mt-2">
                        ${indicators.volume_ratio?.toFixed(2) || '1.00'}x
                    </div>
                    <small class="text-muted">
                        ${indicators.volume_ratio > 1.5 ? 'Ortalama √ºst√º hacim' : 
                          indicators.volume_ratio > 1 ? 'Hafif y√ºksek' : 
                          'Normal hacim'}
                    </small>
                </div>
            </div>
            <div class="col-md-6">
                <div class="indicator-detail-card neutral">
                    <div class="d-flex justify-content-between">
                        <span><i class="fas fa-ruler-combined"></i> ATR</span>
                        <span class="badge ${indicators.atr_percent > 5 ? 'bg-warning' : 'bg-secondary'}">
                            ${indicators.atr_percent > 5 ? 'Y√úKSEK' : 
                              indicators.atr_percent > 3 ? 'ORTA' : 'D√ú≈û√úK'}
                        </span>
                    </div>
                    <div class="fs-5 mt-2">
                        $${indicators.atr?.toFixed(2) || '0.00'}
                    </div>
                    <small class="text-muted">
                        ${indicators.atr_percent?.toFixed(2) || '0'}% volatilite
                    </small>
                </div>
            </div>
            <div class="col-md-6">
                <div class="indicator-detail-card neutral">
                    <div class="d-flex justify-content-between">
                        <span><i class="fas fa-sync-alt"></i> Stoch RSI</span>
                        <span class="badge ${indicators.stoch_rsi >= 0.8 ? 'bg-danger' : indicators.stoch_rsi <= 0.2 ? 'bg-success' : 'bg-secondary'}">
                            ${indicators.stoch_rsi >= 0.8 ? 'A≈ûIRI ALIM' : 
                              indicators.stoch_rsi <= 0.2 ? 'A≈ûIRI SATIM' : 'N√ñTR'}
                        </span>
                    </div>
                    <div class="fs-5 mt-2">
                        ${indicators.stoch_rsi ? (indicators.stoch_rsi * 100).toFixed(1) : '50'}%
                    </div>
                    <small class="text-muted">
                        ${indicators.stoch_rsi >= 0.8 ? 'RSI a≈üƒ±rƒ± alƒ±mda' : 
                          indicators.stoch_rsi <= 0.2 ? 'RSI a≈üƒ±rƒ± satƒ±mda' : 
                          'Normal momentum'}
                    </small>
                </div>
            </div>
        </div>
    `;
}

// ========== PATTERNLERƒ∞ G√úNCELLE ==========
function updatePatterns(patterns) {
    const container = document.getElementById('patternsContainer');
    
    if (!patterns || patterns.length === 0) {
        container.innerHTML = '<span class="text-muted">üìä Tespit edilen pattern yok</span>';
        document.getElementById('patternCount').innerHTML = 'Son 24 saat: 0 pattern';
        return;
    }
    
    container.innerHTML = '';
    patterns.slice(0, 8).forEach(p => {
        const tag = document.createElement('span');
        tag.className = `pattern-tag pattern-${p.direction || 'neutral'}`;
        tag.innerHTML = p.name;
        container.appendChild(tag);
    });
    
    document.getElementById('patternCount').innerHTML = 
        `Son 24 saat: ${patterns.length} pattern tespit edildi`;
}

// ========== MARKET STRUCTURE G√úNCELLE ==========
function updateMarketStructure(structure) {
    if (!structure) return;
    
    // Structure
    document.getElementById('structureValue').innerHTML = structure.structure || 'N√∂tr';
    document.getElementById('structureSignal').innerHTML = 
        structure.structure?.toUpperCase() || 'N√ñTR';
    document.getElementById('structureSignal').className = 
        `badge ${structure.structure === 'Bullish' ? 'bg-success' : 
                structure.structure === 'Bearish' ? 'bg-danger' : 'bg-secondary'}`;
    document.getElementById('structureDesc').innerHTML = 
        structure.description || 'Yapƒ± analizi yapƒ±lƒ±yor';
    
    // Trend
    document.getElementById('trendValue').innerHTML = structure.trend || 'Sideways';
    document.getElementById('trendSignal').innerHTML = 
        structure.trend?.toUpperCase().replace(' ', '_') || 'SIDEWAYS';
    document.getElementById('trendSignal').className = 
        `badge ${structure.trend === 'Uptrend' ? 'bg-success' : 
                structure.trend === 'Downtrend' ? 'bg-danger' : 'bg-secondary'}`;
    document.getElementById('trendDesc').innerHTML = 
        `G√º√ß: ${structure.trend_strength || 'Normal'}`;
    
    // Volatility
    document.getElementById('volatilityValue').innerHTML = 
        structure.volatility || 'Normal';
    document.getElementById('volatilitySignal').innerHTML = 
        structure.volatility?.toUpperCase() || 'NORMAL';
    document.getElementById('volatilitySignal').className = 
        `badge ${structure.volatility === 'High' ? 'bg-warning' : 
                structure.volatility === 'Low' ? 'bg-info' : 'bg-secondary'}`;
    document.getElementById('volatilityDesc').innerHTML = 
        structure.volatility_index ? 
        `Volatilite indeksi: ${structure.volatility_index.toFixed(1)}` : 
        'Normal volatilite';
}

// ========== ML STATS G√úNCELLE ==========
function updateMLStats(stats) {
    if (!stats) return;
    
    // LightGBM
    if (stats.lgbm) {
        document.getElementById('lgbmAccuracy').innerHTML = stats.lgbm.toFixed(1) + '%';
        document.getElementById('lgbmBar').style.width = stats.lgbm + '%';
    }
    
    // LSTM
    if (stats.lstm) {
        document.getElementById('lstmAccuracy').innerHTML = stats.lstm.toFixed(1) + '%';
        document.getElementById('lstmBar').style.width = stats.lstm + '%';
    }
    
    // Transformer
    if (stats.transformer) {
        document.getElementById('transformerAccuracy').innerHTML = stats.transformer.toFixed(1) + '%';
        document.getElementById('transformerBar').style.width = stats.transformer + '%';
    }
    
    // Ensemble tahmini
    const avg = ((stats.lgbm || 0) + (stats.lstm || 0) + (stats.transformer || 0)) / 3;
    let prediction = 'N√ñTR';
    let color = 'text-warning';
    
    if (avg > 70) {
        prediction = 'BULLISH';
        color = 'text-success';
    } else if (avg < 40) {
        prediction = 'BEARISH';
        color = 'text-danger';
    }
    
    document.getElementById('ensemblePrediction').innerHTML = 
        `<span class="${color} fw-bold">${prediction}</span>`;
}

// ========== TRADINGVIEW WIDGET ==========
function loadTradingView() {
    const container = document.getElementById('tradingview-widget');
    const symbol = document.getElementById('symbolSelect').value;
    const interval = document.getElementById('intervalSelect').value;
    const tvInterval = intervalMap[interval] || '60';
    
    container.innerHTML = '';
    
    try {
        new TradingView.widget({
            width: '100%',
            height: '100%',
            symbol: `BINANCE:${symbol}USDT`,
            interval: tvInterval,
            timezone: 'Etc/UTC',
            theme: 'dark',
            style: '1',
            locale: 'tr',
            toolbar_bg: '#1a1e24',
            enable_publishing: false,
            allow_symbol_change: true,
            details: true,
            container_id: 'tradingview-widget',
            autosize: true
        });
    } catch (error) {
        console.error('TradingView error:', error);
        container.innerHTML = '<div class="text-center py-5 text-danger">Grafik y√ºklenemedi</div>';
    }
}

// ========== EXCHANGE GRID RENDER ==========
function renderExchangeGrid() {
    const grid = document.getElementById('exchangeGrid');
    grid.innerHTML = exchangeList.map(ex => `
        <div class="exchange-card" id="exchange-${ex.name.toLowerCase().replace('.', '')}">
            <div class="exchange-logo ${ex.color}"><i class="fas ${ex.icon}"></i></div>
            <div class="exchange-name-small">${ex.name}</div>
            <div class="exchange-status status-waiting" style="background: rgba(255,255,255,0.1); color: var(--text-muted);">Bekleniyor</div>
        </div>
    `).join('');
}

// ========== HATA DURUMU - SENTETƒ∞K VERƒ∞ YOK! ==========
function showNoDataMessage(errorMsg) {
    // Fƒ∞YAT
    document.getElementById('currentPrice').innerHTML = '‚Äî';
    document.getElementById('priceChange').innerHTML = 'Veri yok';
    document.getElementById('volume24h').innerHTML = '‚Äî';
    document.getElementById('sourceCount').innerHTML = '‚Äî';
    
    // Sƒ∞NYAL
    document.getElementById('signalText').innerHTML = 'BAƒûLANTI YOK';
    document.getElementById('signalBadge').className = 'signal-badge signal-neutral';
    document.getElementById('confidenceFill').style.width = '0%';
    document.getElementById('confidenceText').innerHTML = 'G√ºven: 0%';
    document.getElementById('signalRecommendation').innerHTML = errorMsg || 'Backend baƒülantƒ±sƒ± kurulamadƒ±';
    
    // Sƒ∞NYAL DAƒûILIMI
    document.getElementById('buySignalBar').style.width = '0%';
    document.getElementById('buySignalValue').innerHTML = '0%';
    document.getElementById('sellSignalBar').style.width = '0%';
    document.getElementById('sellSignalValue').innerHTML = '0%';
    document.getElementById('neutralSignalBar').style.width = '0%';
    document.getElementById('neutralSignalValue').innerHTML = '0%';
    
    // TEKNƒ∞K G√ñSTERGELER
    document.getElementById('detailedIndicators').innerHTML = `
        <div class="text-center py-5">
            <i class="fas fa-exclamation-triangle text-warning fa-3x mb-3"></i>
            <p class="text-muted">${errorMsg || 'Backend baƒülantƒ±sƒ± bekleniyor...'}</p>
            <p class="text-muted small mt-2">SENTETƒ∞K VERƒ∞ KULLANILMIYOR - SADECE GER√áEK VERƒ∞</p>
        </div>
    `;
    
    // PATTERN
    document.getElementById('patternsContainer').innerHTML = 
        '<span class="text-muted">‚ö†Ô∏è Backend baƒülantƒ±sƒ± yok</span>';
    document.getElementById('patternCount').innerHTML = 'Veri bekleniyor';
    
    // MARKET STRUCTURE
    document.getElementById('structureValue').innerHTML = 'Veri yok';
    document.getElementById('trendValue').innerHTML = 'Veri yok';
    document.getElementById('volatilityValue').innerHTML = 'Veri yok';
    
    // ML
    document.getElementById('lgbmAccuracy').innerHTML = '-%';
    document.getElementById('lstmAccuracy').innerHTML = '-%';
    document.getElementById('transformerAccuracy').innerHTML = '-%';
    document.getElementById('ensemblePrediction').innerHTML = 
        '<span class="text-danger">BAƒûLANTI YOK</span>';
    
    // ZAMAN
    document.getElementById('lastUpdate').innerHTML = '‚Äî';
}

// ========== AI DEƒûERLENDƒ∞RME ==========
async function evaluateAI() {
    if (!currentAnalysisData) {
        showNotification('‚ö†Ô∏è √ñnce bir analiz yapƒ±n', 'warning');
        return;
    }
    
    const symbol = document.getElementById('symbolSelect').value;
    const price = currentAnalysisData.price_data?.current;
    const signal = currentAnalysisData.signal?.signal || 'NEUTRAL';
    const confidence = currentAnalysisData.signal?.confidence || 0;
    
    const chatDiv = document.getElementById('chatMessages');
    const aiMessage = document.createElement('div');
    aiMessage.className = 'chat-message chat-bot mt-2';
    aiMessage.innerHTML = `
        <strong>ü§ñ AI Deƒüerlendirme:</strong><br>
        üìà ${symbol}/USDT - $${price?.toFixed(2) || '0.00'}<br>
        üéØ Sinyal: <span class="${signal.includes('BUY') ? 'text-success' : signal.includes('SELL') ? 'text-danger' : 'text-warning'} fw-bold">${signal.replace('_', ' ')}</span><br>
        ‚ö° G√ºven: %${confidence.toFixed(1)}<br>
        üîÆ Zaman: ${new Date().toLocaleTimeString('tr-TR')}<br>
        <small class="text-muted">11+ Exchange ortalamasƒ± baz alƒ±ndƒ±</small>
    `;
    chatDiv.appendChild(aiMessage);
    chatDiv.scrollTop = chatDiv.scrollHeight;
    
    showNotification('ü§ñ AI deƒüerlendirmesi tamamlandƒ±', 'success');
}

// ========== ML MODELLERƒ∞ Eƒûƒ∞T ==========
async function trainML() {
    const symbol = document.getElementById('symbolSelect').value;
    
    if (!backendUrl) {
        showNotification('‚ö†Ô∏è Backend baƒülƒ± deƒüil', 'error');
        return;
    }
    
    try {
        showNotification('üß† ML modelleri eƒüitiliyor...', 'info');
        
        const response = await fetch(`${backendUrl}/api/train/${symbol}USDT`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        });
        
        if (response.ok) {
            const data = await response.json();
            showNotification(`‚úÖ ${data.message || 'Eƒüitim tamamlandƒ±'}`, 'success');
            
            // 3 saniye sonra analizi yenile
            setTimeout(() => analyze(), 3000);
        } else {
            throw new Error('Eƒüitim ba≈üarƒ±sƒ±z');
        }
        
    } catch (error) {
        console.error('ML eƒüitim hatasƒ±:', error);
        showNotification('‚ùå ML eƒüitimi ba≈üarƒ±sƒ±z', 'error');
    }
}

// ========== YENƒ∞LE ==========
function forceRefresh() {
    analyze();
}

// ========== Bƒ∞LDƒ∞Rƒ∞M G√ñSTER ==========
function showNotification(text, type = 'info') {
    const div = document.createElement('div');
    div.className = 'notification ' + type;
    div.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'} me-2"></i> ${text}`;
    document.body.appendChild(div);
    setTimeout(() => div.remove(), 4000);
}

// ========== EVENT LISTENERS ==========
document.getElementById('symbolSelect').addEventListener('change', function() {
    loadTradingView();
    updateGaugeWidget();
    analyze();
});

document.getElementById('intervalSelect').addEventListener('change', function() {
    loadTradingView();
    updateGaugeWidget();
    analyze();
});

// Sayfa kapandƒ±ƒüƒ±nda interval'i temizle
window.addEventListener('beforeunload', function() {
    if (refreshInterval) clearInterval(refreshInterval);
});

// ========== NOTIFICATION STYLES ==========
const style = document.createElement('style');
style.textContent = `
    .bg-purple { background-color: #8b5cf6; }
    .text-purple { color: #8b5cf6; }
    .text-orange { color: #f97316; }
    .text-teal { color: #14b8a6; }
    .text-cyan { color: #06b6d4; }
    .status-waiting { 
        background: rgba(255,255,255,0.1); 
        color: var(--text-muted);
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        display: inline-block;
        margin-top: 8px;
    }
`;
document.head.appendChild(style);
</script>

</body>
</html>
